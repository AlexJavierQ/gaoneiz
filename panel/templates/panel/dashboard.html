{% extends 'panel/panel_base.html' %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="h2">{{ title }}</h1>
  <div class="text-muted">
    <i class="fas fa-calendar me-1"></i>{% now "d 'de' F, Y" %}
  </div>
</div>

<!-- KPIs -->
<div class="row g-4 mb-4">
  <div class="col-md-6 col-xl-4">
    <div class="card shadow-sm h-100">
      <div class="card-body d-flex align-items-center">
        <div class="icon-circle bg-primary me-3">
          <i class="fas fa-users text-white"></i>
        </div>
        <div>
          <h3 class="mb-0 text-primary">{{ kpis.total_usuarios }}</h3>
          <p class="mb-0 text-muted">Usuarios Registrados</p>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-6 col-xl-4">
    <div class="card shadow-sm h-100">
      <div class="card-body d-flex align-items-center">
        <div class="icon-circle bg-success me-3">
          <i class="fas fa-handshake text-white"></i>
        </div>
        <div>
          <h3 class="mb-0 text-success">{{ kpis.total_socios }}</h3>
          <p class="mb-0 text-muted">Socios Activos</p>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-6 col-xl-4">
    <div class="card shadow-sm h-100">
      <div class="card-body d-flex align-items-center">
        <div class="icon-circle bg-warning me-3">
          <i class="fas fa-clock text-white"></i>
        </div>
        <div>
          <h3 class="mb-0 text-warning">{{ kpis.solicitudes_pendientes }}</h3>
          <p class="mb-0 text-muted">Solicitudes Pendientes</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Gráfico y Actividad -->
<div class="row g-4">
  <div class="col-lg-8">
    <div class="card shadow-sm h-100">
      <div class="card-header bg-light">
        <h5 class="card-title mb-0">Nuevos Usuarios (Últimos 7 días)</h5>
      </div>
      <div class="card-body">
        <canvas id="userTrendChart" aria-label="Gráfico de nuevos usuarios" role="img"></canvas>
      </div>
    </div>
  </div>

  <div class="col-lg-4">
    <div class="card shadow-sm h-100">
      <div class="card-header bg-light">
        <h5 class="card-title mb-0">Actividad Reciente del Admin</h5>
      </div>
      <div class="list-group list-group-flush">
        {% for actividad in actividad_reciente %}
        <div class="list-group-item">
          <div class="small">{{ actividad.accion }}</div>
          <small class="text-muted">
            Por: {{ actividad.actor.get_full_name|default:actividad.actor.email }} - {{ actividad.timestamp|timesince }}
            atrás
          </small>
        </div>
        {% empty %}
        <div class="list-group-item text-muted">No hay actividad reciente.</div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{{ chart_labels|json_script:"chart-labels" }}
{{ chart_data|json_script:"chart-data" }}

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const ctx = document.getElementById('userTrendChart');
    if (ctx) {
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: JSON.parse(document.getElementById('chart-labels').textContent),
          datasets: [{
            label: 'Nuevos Usuarios',
            data: JSON.parse(document.getElementById('chart-data').textContent),
            borderColor: '#0d6efd',
            backgroundColor: 'rgba(13, 110, 253, 0.1)',
            fill: true,
            tension: 0.3
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false }
          }
        }
      });
    }
  });
</script>
{% endblock %}